<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ ‚Äî Vysotsky Estate</title>
    <style>
      /* === –ë–†–ï–ù–î ===
       –ó–∞–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª /assets/brand-font.woff2 –Ω–∞ –≤–∞—à —à—Ä–∏—Ñ—Ç –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –∏–º—è –≤ font-family –Ω–∏–∂–µ.
       –¶–≤–µ—Ç --primary –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ç–æ—á–Ω–æ–µ —Ñ–∏—Ä–º–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. */
      @font-face {
        font-family: "BrandFont";
        src: url("assets/Gilroy-Regular.woff2") format("woff2");
        font-weight: 100 900;
        font-style: normal;
        font-display: swap;
      }
      :root {
        --bg: #f5f7fb; /* —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω */
        --text: #101828; /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç */
        --muted: #667085; /* –≤—Ç–æ—Ä–∏—á–Ω—ã–π —Ç–µ–∫—Å—Ç */
        --primary: #2b6bff; /* –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å–∏–Ω–∏–π */
        --primary-weak: #e7efff;
        --card: #ffffff; /* –±–µ–ª—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        --border: #e6e9f0; /* —Å–≤–µ—Ç–ª—ã–µ –±–æ—Ä–¥–µ—Ä—ã */
        --radius: 16px;
        --shadow: 0 6px 18px rgba(16, 24, 40, 0.06);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font: 16px/1.6 BrandFont, system-ui, -apple-system, Segoe UI, Roboto,
          Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial;
      }
      img {
        max-width: 100%;
        height: auto;
        border-radius: 12px;
      }
      a {
        color: var(--primary);
      }

      /* –®–∞–ø–∫–∞ */
      header {
        position: sticky;
        top: 0;
        z-index: 20;
        background: #fff;
        border-bottom: 1px solid var(--border);
        box-shadow: 0 2px 8px rgba(16, 24, 40, 0.04);
      }
      .hdr {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 20px;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .logo {
        width: 36px;
        height: 36px;
        border-radius: 999px;
        background: #101828;
        display: grid;
        place-items: center;
        color: #fff;
        font-weight: 700;
      }
      .brand .sub {
        font-size: 12px;
        color: #98a2b3;
        margin-top: 2px;
      }
      .contact {
        display: flex;
        align-items: flex-end;
        gap: 4px;
        color: #475467;
      }

      /* –ö–æ–Ω—Ç–µ–Ω—Ç */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      .wrap {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 20px;
      }
      @media (max-width: 980px) {
        .wrap {
          grid-template-columns: 1fr;
        }
      }

      /* –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ø—Ä–æ–≥—Ä–µ—Å—Å + –º–µ–Ω—é */
      .left {
        position: sticky;
        top: 84px;
        align-self: start;
      }
      .panel {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 14px;
      }
      .panel h2 {
        font-size: 20px;
        margin: 4px 8px 10px;
      }
      .progress-box {
        padding: 8px 10px;
      }
      .progress-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #475467;
        font-size: 14px;
        margin-bottom: 8px;
      }
      .progress {
        height: 8px;
        border-radius: 999px;
        background: var(--primary-weak);
        overflow: hidden;
      }
      .progress > span {
        display: block;
        height: 100%;
        width: 21%;
        background: var(--primary);
      }

      .toc {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-top: 10px;
      }
      .toc button {
        appearance: none;
        background: transparent;
        border: 0;
        text-align: left;
        padding: 10px 12px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        color: #475467;
      }
      .toc button[aria-current="step"] {
        background: #f0f4ff;
        color: #1f3b8f;
        box-shadow: inset 0 0 0 1px #d7e2ff;
      }
      .toc .icon {
        width: 22px;
        height: 22px;
        border-radius: 6px;
        background: #eef2f7;
        display: grid;
        place-items: center;
        color: #3b82f6;
      }
      .toc .icon svg {
        width: 16px;
        height: 16px;
        stroke: currentColor;
        fill: none;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
      }
      .toc button[data-read="1"]::after {
        content: "‚úì";
        margin-left: auto;
        color: #16a34a;
        font-weight: 700;
      }

      /* –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 22px;
      }
      .card h1 {
        font-size: 28px;
        line-height: 1.2;
        margin: 0 0 16px;
      }
      .callout {
        display: flex;
        gap: 12px;
        align-items: flex-start;
        background: #fff7e6;
        border: 1px solid #ffecbf;
        border-radius: 12px;
        padding: 12px 14px;
        margin: 18px 0;
        color: #7a4b00;
      }
      .callout .badge {
        flex: 0 0 auto;
        width: 28px;
        height: 28px;
        border-radius: 999px;
        display: grid;
        place-items: center;
        background: #ffe8b0;
      }
      .muted {
        color: var(--muted);
      }
      .hint {
        font-size: 14px;
        color: #475467;
        margin-top: 8px;
      }

      /* –ù–∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: –Ω–∞–≤–∏–≥–∞—Ü–∏—è ‚Äî –ù–ï –ø—Ä–∏–ª–∏–ø–∞–µ—Ç */
      .nav {
        margin-top: 18px;
      }
      .nav .bar {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .btn {
        appearance: none;
        border: 0;
        border-radius: 10px;
        padding: 12px 18px;
        font-weight: 600;
        height: 80px;
        cursor: pointer;
      }
      .btn.primary {
        background: var(--primary);
        color: #fff;
      }
      .btn.ghost {
        background: #eef2ff;
        color: #1f3b8f;
      }
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      /* —á—Ç–æ–±—ã –Ω–∞ —à–∞–≥–∞—Ö 2+ –∫–Ω–æ–ø–∫–∏ –¥–µ–ª–∏–ª–∏ —à–∏—Ä–∏–Ω—É –ø–æ–ø–æ–ª–∞–º */
      .nav .bar .btn {
        flex: 1;
      }

      /* –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –±–ª–æ–∫–∞ */
      .crumbs {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #667085;
        font-size: 14px;
        margin-bottom: 6px;
      }

      /* –ò–∫–æ–Ω-—Å—Ç—Ä–∏–Ω–≥ –≤ —Å–ø–∏—Å–∫–µ —Å–ª–µ–≤–∞ */
      .toc .text {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* –ë–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç) */
      #test-results {
        display: none;
        margin-top: 16px;
        padding: 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: #fafbff;
        font-size: 14px;
      }
      #test-results.show {
        display: block;
      }
      #test-results .ok {
        color: #16a34a;
      }
      #test-results .fail {
        color: #dc2626;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="hdr">
        <div class="brand">
          <div class="logo">VE</div>
          <div>
            <div style="font-weight: 700">Vysotsky Estate –Ω–∞ –°–µ–ª–∏–≥–µ—Ä—Å–∫–æ–π</div>
            <div class="sub">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥—É</div>
          </div>
        </div>
        <div class="contact">
          <div>–Ø–Ω–∞ –ê—Ä—Ç—é—à–µ–≤–∞</div>
          <div>¬∑</div>
          <div>–¢–µ–ª.: +79651101050</div>
        </div>
      </div>
    </header>

    <div class="container">
      <div class="wrap" id="app">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <aside class="left">
          <div class="panel">
            <h2>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–æ—Å—Ç–∏</h2>
            <div class="progress-box">
              <div class="progress-label">
                <span>–ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</span><span id="progressN">0%</span>
              </div>
              <div class="progress">
                <span id="progressBar" style="width: 0%"></span>
              </div>
            </div>
            <div class="toc" id="toc"></div>
            <div style="padding: 10px 12px; color: #98a2b3; font-size: 13px">
              <div><a href="#" rel="nofollow">–û –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ</a></div>
              <div>
                <a href="#" rel="nofollow">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
              </div>
            </div>
            <div id="test-results" aria-live="polite"></div>
          </div>
        </aside>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –∫–æ–Ω—Ç–µ–Ω—Ç —à–∞–≥–∞ -->
        <main id="stage" class="card" aria-live="polite"></main>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        try {
          // === –ò–ö–û–ù–ö–ò SVG ===
          const icons = {
            doc: '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 3h7l4 4v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/><path d="M14 3v5h5"/></svg>',
            clock:
              '<svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 2"/></svg>',
            office:
              '<svg viewBox="0 0 24 24" aria-hidden="true"><rect x="4" y="3" width="8" height="18" rx="1"/><rect x="14" y="8" width="6" height="13" rx="1"/><path d="M8 7h0M8 11h0M8 15h0M17 12h0M17 16h0"/></svg>',
            team: '<svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="8" cy="8" r="3"/><circle cx="16" cy="8" r="3"/><path d="M3 20c0-3 3-5 5-5s5 2 5 5"/><path d="M11 20c0-3 3-5 5-5s5 2 5 5"/></svg>',
            pin: '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 22s7-6 7-12a7 7 0 1 0-14 0c0 6 7 12 7 12z"/><circle cx="12" cy="10" r="3"/></svg>',
            bulb: '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M9 18h6M10 22h4"/><path d="M12 2a7 7 0 0 0-4 12c1 1 1 2 1 3h6c0-1 0-2 1-3a7 7 0 0 0-4-12z"/></svg>',
            shake:
              '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 12l3-3a2 2 0 0 1 3 3l-6 6-3-3-4 4"/></svg>',
            chat: '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/></svg>',
            target:
              '<svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="8"/><circle cx="12" cy="12" r="4"/></svg>',
            gift: '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M20 12v8H4v-8M2 8h20v4H2z"/><path d="M12 8v12"/><path d="M12 8c-1.5 0-4-1-4-3s2.5-2 4 1c1.5-3 4-2 4 0s-2.5 2-4 2z"/></svg>',
            book: '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 19h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2z"/><path d="M4 15h16"/></svg>',
            person:
              '<svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="8" r="3"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/></svg>',
            arrow:
              '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M5 12h14"/><path d="M13 5l7 7-7 7"/></svg>',
          };
          const icon = (name) => icons[name] || icons.doc;

          // === –î–ê–ù–ù–´–ï –®–ê–ì–û–í ===
          const steps = [
            {
              id: "welcome",
              title:
                "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–∞–Ω–∏—é Vysotsky Estate –Ω–∞ –°–µ–ª–∏–≥–µ—Ä—Å–∫–æ–π!",
              icon: "doc",
              html: `
              <div class="crumbs">–î–∞–≤–∞–π—Ç–µ –∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è</div>
              <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–∞–Ω–∏—é Vysotsky Estate –Ω–∞ –°–µ–ª–∏–≥–µ—Ä—Å–∫–æ–π!</h1>
              <img src="assets/welcome-hero.jpg" alt="–§–æ—Ç–æ –æ—Ñ–∏—Å–∞/—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è"/>
              <div class="callout"><div class="badge">‚úì</div>
                <div>
                  <strong>–í—Å–µ–≥–æ —á–µ—Ä–µ–∑ 20 –º–∏–Ω—É—Ç</strong> –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å <strong>–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å</strong> –≤ –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ. –î–ª—è —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ –ø—Ä–æ–π—Ç–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é –¥–æ –∫–æ–Ω—Ü–∞ –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã.
                </div>
              </div>
              <p>–í—ã –æ—Ç–∫–ª–∏–∫–Ω—É–ª–∏—Å—å –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é –≤ <strong>–æ—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</strong>, –∞ –∑–Ω–∞—á–∏—Ç –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Å—Ç–∞—Ç—å —á–∞—Å—Ç—å—é –±–æ–ª—å—à–æ–π –∫–æ–º–∞–Ω–¥—ã. –≠—Ç–æ –æ—Ç–ª–∏—á–Ω–æ.</p>
              <h3>–û —á—ë–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è?</h3>
              <p>–ú—ã —Ä–∞—Å—Å–∫–∞–∂–µ–º, —á—Ç–æ –º—ã –¥–µ–ª–∞–µ–º, –∫—Ç–æ –Ω–∞–º –Ω—É–∂–µ–Ω –∏ –Ω–∞ –∫–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö. –í—ã –ø–æ–π–º—ë—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏—è –∞–≥–µ–Ω—Ç–∞ –ø–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏. –ó–∞—Ç–µ–º –≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è –∏ –æ–±—Å—É–¥–∏–º, <strong>–∫–∞–∫ –Ω–∞—á–∞—Ç—å –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ —Ä—ã–Ω–∫–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</strong>.</p>
              <h3>–î–∞–ª–µ–µ –≤—ã —É–∑–Ω–∞–µ—Ç–µ:</h3>
              <ul>
                <li>‚úÖ –ö–∞–∫ –º—ã –≤—ã–≥–ª—è–¥–∏–º –∏ –≥–¥–µ –Ω–∞—Ö–æ–¥–∏–º—Å—è;</li>
                <li>‚úÖ –ö—Ç–æ –Ω–∞—à–∏ –∫–ª–∏–µ–Ω—Ç—ã –∏ –∑–∞ —á—Ç–æ –æ–Ω–∏ –Ω–∞–º –ø–ª–∞—Ç—è—Ç;</li>
                <li>‚úÖ –ß—Ç–æ –º—ã –¥–µ–ª–∞–µ–º –∏ —á—Ç–æ –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç –¥–µ–ª–∞—Ç—å –≤–∞–º;</li>
                <li>‚úÖ –ö—Ç–æ –Ω–∞–º –Ω—É–∂–µ–Ω –∏ –∫–∞–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è;</li>
                <li>üí∞ –ù–∞ –∫–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö (—Å–∏—Å—Ç–µ–º–∞ –±–æ–Ω—É—Å–æ–≤ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏–∏);</li>
                <li>‚úÖ –ü–∞—Ä—É –≤–∞–∂–Ω—ã—Ö –∞–∫—Ü–µ–Ω—Ç–æ–≤ –≤ –∫–æ–Ω—Ü–µ.</li>
              </ul>
            `,
            },
            {
              id: "history",
              icon: "clock",
              title: "–ù–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è",
              html: `<h1>–ù–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è</h1><p class="muted">–ó–¥–µ—Å—å –¥–æ–±–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç/—Ñ–æ—Ç–æ. <img src="assets/history.jpg" alt="–ò—Å—Ç–æ—Ä–∏—è"/></p>`,
            },
            {
              id: "office",
              icon: "office",
              title: "–ù–∞—à –æ—Ñ–∏—Å",
              html: `<h1>–ù–∞—à –æ—Ñ–∏—Å</h1><p class="muted">–§–æ—Ç–æ –∏ –∫–∞—Ä—Ç–∞. <img src="assets/office.jpg" alt="–û—Ñ–∏—Å"/></p>`,
            },
            {
              id: "team",
              icon: "team",
              title: "–ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞",
              html: `<h1>–ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞</h1><img src="assets/team.jpg" alt="–ö–æ–º–∞–Ω–¥–∞"/>`,
            },
            {
              id: "geo",
              icon: "pin",
              title: "–ì–¥–µ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è? –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –±–∏–∑–Ω–µ—Å–∞",
              html: `<h1>–ì–µ–æ–≥—Ä–∞—Ñ–∏—è –±–∏–∑–Ω–µ—Å–∞</h1><p class="muted">–ö–∞—Ä—Ç–∞/–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.</p>`,
            },
            {
              id: "why",
              icon: "bulb",
              title: "–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Å—Ñ–µ—Ä–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏?",
              html: `<h1>–ü–æ—á–µ–º—É –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</h1><p class="muted">–ê—Ä–≥—É–º–µ–Ω—Ç—ã –∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞.</p>`,
            },
            {
              id: "withwhom",
              icon: "shake",
              title: "–° –∫–µ–º –≤—ã –±—É–¥–µ—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å?",
              html: `<h1>–° –∫–µ–º –≤—ã –±—É–¥–µ—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å</h1><p class="muted">–°–º–µ–∂–Ω—ã–µ –æ—Ç–¥–µ–ª—ã, –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∏.</p>`,
            },
            {
              id: "reviews",
              icon: "chat",
              title: "–ß—Ç–æ –∫–ª–∏–µ–Ω—Ç—ã –≥–æ–≤–æ—Ä—è—Ç –æ –Ω–∞—Å?",
              html: `<h1>–û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤</h1><img src="assets/reviews.jpg" alt="–û—Ç–∑—ã–≤—ã"/>`,
            },
            {
              id: "weNeed",
              icon: "target",
              title: "–ò—Ç–∞–∫, –∫–æ–≥–æ –º—ã –∏—â–µ–º? –ü–æ–≥–æ–≤–æ—Ä–∏–º –Ω–∞ —á–∏—Å—Ç–æ—Ç—É.",
              html: `<h1>–ö–æ–≥–æ –º—ã –∏—â–µ–º</h1><p class="muted">–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º.</p>`,
            },
            {
              id: "benefits",
              icon: "gift",
              title: "–ê —á—Ç–æ –≤–∑–∞–º–µ–Ω?",
              html: `<h1>–ß—Ç–æ –≤–∑–∞–º–µ–Ω</h1><p class="muted">–£—Å–ª–æ–≤–∏—è, –±–æ–Ω—É—Å—ã, –æ–±—É—á–µ–Ω–∏–µ.</p>`,
            },
            {
              id: "recap",
              icon: "book",
              title: "–î–∞–≤–∞–π—Ç–µ –∑–∞–∫—Ä–µ–ø–∏–º",
              html: `<h1>–î–∞–≤–∞–π—Ç–µ –∑–∞–∫—Ä–µ–ø–∏–º</h1><p class="muted">–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ.</p>`,
            },
            {
              id: "aboutyou",
              icon: "person",
              title: "–¢–µ–ø–µ—Ä—å –æ –≤–∞—Å",
              html: `<h1>–¢–µ–ø–µ—Ä—å –æ –≤–∞—Å</h1><p class="muted">–§–æ—Ä–º–∞/–≤–æ–ø—Ä–æ—Å—ã.</p>`,
            },
            {
              id: "next",
              icon: "arrow",
              title: "–ò—Ç–∞–∫, —á—Ç–æ –¥–∞–ª—å—à–µ?",
              html: `<h1>–ß—Ç–æ –¥–∞–ª—å—à–µ</h1><p class="muted">–®–∞–≥–∏ –ø–æ—Å–ª–µ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è.</p>`,
            },
          ];

          // Helpers
          const $ = (id) => document.getElementById(id);
          const toc = $("toc");
          const stage = $("stage");
          const progressN = $("progressN");
          const progressBar = $("progressBar");
          if (!toc || !stage || !progressN || !progressBar) {
            throw new Error(
              "–ù–µ –Ω–∞–π–¥–µ–Ω—ã –∫–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (toc/stage/progress)."
            );
          }

          // localStorage
          const STEP_KEY = "ve_demo_step";
          const READ_KEY = "ve_demo_readSteps";
          const getReadSet = () => {
            try {
              return new Set(
                JSON.parse(localStorage.getItem(READ_KEY) || "[]")
              );
            } catch {
              return new Set();
            }
          };
          const setReadSet = (set) => {
            try {
              localStorage.setItem(READ_KEY, JSON.stringify(Array.from(set)));
            } catch {}
          };
          const isStepRead = (i) => getReadSet().has(i);
          const markStepRead = (i) => {
            const s = getReadSet();
            if (!s.has(i)) {
              s.add(i);
              setReadSet(s);
              updateReadBadges();
            }
          };

          // Menu
          steps.forEach((s, i) => {
            const b = document.createElement("button");
            b.type = "button";
            b.dataset.index = i;
            b.setAttribute("data-testid", "toc-item-" + i);
            b.innerHTML = `<span class="icon">${icon(
              s.icon
            )}</span><span class="text">${s.title}</span>`;
            b.addEventListener("click", () => gotoStep(i));
            toc.appendChild(b);
          });
          function updateReadBadges() {
            const rs = getReadSet();
            Array.from(toc.children).forEach((el, i) => {
              el.setAttribute("data-read", rs.has(i) ? "1" : "0");
            });
          }

          // Progress by steps
          function updateProgress(val) {
            val = Math.max(0, Math.min(100, Number(val) || 0));
            progressN.textContent = val + "%";
            progressBar.style.width = val + "%";
          }

          function updateNextDisabled(index) {
            const next = $("nextBtn");
            if (!next) return;
            const last = index === steps.length - 1;
            next.disabled = !isStepRead(index) && !last;
          }

          // Render step
          function renderStep(index) {
            const s = steps[index];
            document.title = s.title + " ‚Äî Vysotsky Estate";
            stage.innerHTML = `
            <div id="content">${s.html}</div>
            <div class="hint" id="guardHint" hidden>–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ –∫–æ–Ω—Ü–∞ —à–∞–≥–∞, —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å ¬´–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å¬ª.</div>
            <div class="nav">
              <div class="bar">
                ${
                  index === 0
                    ? `<button class="btn primary" id="nextBtn" data-testid="next" style="flex:1">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>`
                    : `<button class="btn ghost" id="prevBtn" data-testid="prev">–ù–∞–∑–∞–¥</button>
                     <button class="btn primary" id="nextBtn" data-testid="next">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>`
                }
              </div>
            </div>
          `;

            const prev = $("prevBtn");
            const next = $("nextBtn");
            if (prev) prev.onclick = () => gotoStep(index - 1);
            if (next) next.onclick = () => gotoStep(index + 1);
            if (prev) prev.disabled = index === 0;

            // sentinel for scroll guard
            const nav = stage.querySelector(".nav");
            const sentinel = document.createElement("div");
            sentinel.id = "sentinel";
            sentinel.style.height = "1px";
            nav.parentNode.insertBefore(sentinel, nav);

            const guardHint = $("guardHint");
            if (!isStepRead(index)) guardHint.hidden = false;

            function unlock() {
              markStepRead(index);
              guardHint.hidden = true;
              updateNextDisabled(index);
              if (observer) observer.disconnect();
              window.removeEventListener("scroll", onScroll, { passive: true });
            }
            const onScroll = () => {
              const r = sentinel.getBoundingClientRect();
              const vh =
                window.innerHeight || document.documentElement.clientHeight;
              if (r.top <= vh) unlock();
            };
            let observer = null;
            try {
              observer = new IntersectionObserver(
                (entries) => {
                  if (entries.some((e) => e.isIntersecting)) unlock();
                },
                { threshold: 0.6 }
              );
              observer.observe(sentinel);
            } catch {}
            window.addEventListener("scroll", onScroll, { passive: true });

            updateProgress(Math.round(((index + 1) / steps.length) * 100));
            Array.from(toc.children).forEach((el, i) => {
              el.setAttribute("aria-current", i === index ? "step" : "false");
            });
            updateReadBadges();
            updateNextDisabled(index);

            const url = new URL(location.href);
            url.searchParams.set("step", String(index + 1));
            history.replaceState(null, "", url);
            try {
              localStorage.setItem(STEP_KEY, String(index));
            } catch {}
          }

          function gotoStep(i) {
            if (i < 0) i = 0;
            if (i >= steps.length) i = steps.length - 1;
            current = i;
            renderStep(i);
          }

          // Init
          let current = 0;
          const qs = new URLSearchParams(location.search);
          const qsStep = parseInt(qs.get("step") || "1", 10);
          const saved = parseInt(localStorage.getItem(STEP_KEY) || "0", 10);
          if (!isNaN(qsStep) && qsStep >= 1 && qsStep <= steps.length)
            current = qsStep - 1;
          else if (!isNaN(saved) && saved >= 0 && saved < steps.length)
            current = saved;
          renderStep(current);

          // Cross-tab sync
          window.addEventListener("storage", (e) => {
            if (e.key === STEP_KEY && e.newValue != null) {
              const idx = parseInt(e.newValue, 10);
              if (!isNaN(idx) && idx !== current) {
                current = idx;
                renderStep(current);
              }
            }
            if (e.key === READ_KEY && e.newValue != null) {
              updateReadBadges();
              updateNextDisabled(current);
            }
          });

          // Tests
          const testBox = $("test-results");
          function logTest(msg, ok = true) {
            testBox.classList.add("show");
            const p = document.createElement("div");
            p.innerHTML = ok
              ? `‚úÖ <span class="ok">${msg}</span>`
              : `‚ùå <span class="fail">${msg}</span>`;
            testBox.appendChild(p);
          }
          function assert(cond, msg) {
            if (cond) {
              logTest(msg, true);
            } else {
              logTest(msg, false);
              throw new Error("Test failed: " + msg);
            }
          }

          window.__dev_markRead = function () {
            markStepRead(current);
            updateReadBadges();
            updateNextDisabled(current);
          };

          function runTests() {
            try {
              assert(!!stage.querySelector("h1"), "–ï—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ —à–∞–≥–∞");
              assert(
                !!document.getElementById("nextBtn"),
                "–ö–Ω–æ–ø–∫–∞ ¬´–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å¬ª –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω–∞"
              );
              const first =
                (new URLSearchParams(location.search).get("step") || "1") ===
                "1";
              if (!isStepRead(current))
                assert(
                  document.getElementById("nextBtn").disabled,
                  "–ì–µ–π—Ç–∏–Ω–≥ –ø–æ —Å–∫—Ä–æ–ª–ª—É –∞–∫—Ç–∏–≤–µ–Ω (Next disabled)"
                );
              const wasDisabled = document.getElementById("nextBtn").disabled;
              window.__dev_markRead();
              assert(
                !document.getElementById("nextBtn").disabled && wasDisabled,
                "–ü–æ—Å–ª–µ –æ—Ç–º–µ—Ç–∫–∏ ¬´–ø—Ä–æ—á–∏—Ç–∞–Ω¬ª Next —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω"
              );
              const expected =
                Math.round(((current + 1) / steps.length) * 100) + "%";
              assert(
                document.getElementById("progressN").textContent.trim() ===
                  expected,
                "–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω (" + expected + ")"
              );
              if (!first)
                assert(
                  !!document.getElementById("prevBtn"),
                  "–ù–∞ —à–∞–≥–∞—Ö 2+ –µ—Å—Ç—å ¬´–ù–∞–∑–∞–¥¬ª"
                );
              logTest("–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—à–ª–∏");
            } catch (e) {
              console.error(e);
            }
          }
          const auto = qs.get("runTests") === "1";
          if (auto) runTests();
          window.addEventListener("keydown", (e) => {
            if (e.key === "F9") runTests();
          });
        } catch (err) {
          console.error(err);
          const stage = document.getElementById("stage");
          if (stage) {
            stage.innerHTML = `<div class="callout"><div class="badge">!</div><div>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${err.message}</div></div>`;
          }
        }
      });
    </script>
  </body>
</html>
